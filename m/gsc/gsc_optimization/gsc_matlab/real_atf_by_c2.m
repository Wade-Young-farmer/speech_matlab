close all;
clear all;
clc;


% % aj_185_1m_d2
% moments = [47.00811006267665, 53.05853704568263, 61.989149017868954, 68.16328923800685, 68.95018946214208, 74.24663327843685, 74.24663327843685, 80.53549708102877, 80.53549708102877, 86.94643588631027, 88.31370314267308, 93.42855459955203, 93.7614739251477, 99.63296021292591, 99.63296021292591, 105.52537042255975, 106.52412839934676, 111.51791828328183, 112.03242996829333, 117.3288737845881, 118.54413091604155, 123.44712462026871, 124.50641338352767, 129.71206102011453, 131.07400371573317, 136.55203989144377, 136.55203989144377, 141.90901449421048, 142.87250581150647, 149.47036153694793, 150.34805794079108, 155.2813170382542, 157.52095613771598, 163.7556271443258, 176.64466753941454, 180.39757630067484, 187.17702438553212, 193.13930685301824, 194.72739170366913, 199.47905844171643, 200.5383472049754, 206.22824113333778, 207.43885686277656, 213.52220090320657, 214.97258974385028, 221.38885310987595, 223.32583827697803, 228.8341398459246, 238.31848885027318, 243.00962480184856, 245.37032547425423, 252.66428524412305, 254.69206659093305, 261.4412492825544, 264.8179958150178, 271.5066477201672, 274.61666109016176, 280.7302705238277, 284.483179285088, 290.6573195052259, 291.942750755613, 297.9352986163351, 300.1446723225609, 305.5319123185636, 306.7727934412384, 311.4639293928137, 527.851643118506, 533.7590499176224, 536.3858011386621, 542.4086143926202, 547.3418734900832, 553.3041559575694, 553.576544496693, 559.4480307844713, 561.0304605905634, 566.8414160918696, 567.9612356416005, 572.6826369864118, 574.4077644008621, 579.3107581050892, 580.4305776548201, 584.9144975878546, 586.3672364631811, 591.6334148862398, 593.600665446578, 599.9563980261316, 604.5613791923305, 611.1785209261867, 612.9944445203449, 618.1395613704598, 619.1486157938202, 624.4044977703055, 625.0201020815985, 630.0138919655335, 631.1942423017363, 635.9459090397836, 637.2170555556943, 643.3306649893602, 644.1074140976335, 649.131469334462, 650.7052697700951, 656.3648982597755];
% % aj_185_3m_d2
% moments = [34.11367839929327, 40.31982116262949, 46.70184651440034, 52.87242286609165, 73.47363836627233, 78.44860301056615, 86.46550516329854, 91.8424871525858, 95.83753451845811, 101.79241644117343, 105.23620830316104, 110.56293812432412, 113.47756387552656, 118.92992411700008, 121.52063785881046, 127.02325026840816, 134.23443639422797, 138.9581401979009, 140.89340261805188, 146.3960150276496, 148.55685825698933, 153.6574533215936, 157.37611376278292, 162.90385225644272, 172.15537966992122, 177.50723557514638, 180.19572656979003, 185.07018687783548, 202.0823084731743, 208.28845123651055, 210.4209489098776, 215.2451570497989, 220.3206260303411, 226.2503818689943, 232.24515727531718, 236.91860891086594, 240.2352520070618, 245.96399917321833, 247.52181638506792, 252.3208984409271, 254.66283438039704, 260.09006853780846, 262.7283073643279, 268.2309197739256, 271.54756287012145, 277.5962005777167, 279.12889170550415, 284.45562152666724, 288.04865154754606, 293.42563353683335, 294.8666408779042, 301.85169224716526, 304.1632919808775, 311.1232172660764, 317.41581390493013, 323.82296534076306, 332.83278919147045, 338.61178852575114, 344.16465310347303, 349.49138292463607, 351.8883088496221, 357.86831685639953, 360.10453833792553, 365.3056377387781, 366.7634229186832, 371.91427015141164, 375.08015674323497, 381.1606690862607, 389.4020246586262, 395.8275536271529, 398.61654895804486, 404.52117871263596, 406.2548785129202, 411.73236483845574, 415.86403689959144, 421.7435405701205, 424.78379674163335, 429.7101902600407, 433.00170727217443, 438.22793275708915, 439.6601195486283, 444.68533636104627, 445.71550580759197, 451.86817693089347, 455.7878460445795, 461.7678540513569, 463.7025625241378, 470.7442852158406, 472.7041197726836, 478.5333712750884, 479.7142972260067, 485.5184226443494, 485.99581824152915, 490.96756341391244, 497.67622785849045, 502.6009403346601, 505.51556608586253, 511.8249402688624, 512.553596706663, 517.9557047800123];
% aj_185_3m_d4
moments = [4.560112072201626, 9.736085388992155, 16.721136758253163, 20.791562376311735, 20.791562376311735, 25.113248834991207, 30.888754725388615, 36.1903584624896, 39.80851456743055, 44.45684011891719, 44.45684011891719, 49.101467397082935, 51.36281496267103, 55.78500575759887, 55.78500575759887, 60.05644004815416, 60.05644004815416, 66.11880028537189, 174.2972386052191, 180.1013640235619, 180.55363353667954, 186.43313720720863, 186.7849023840779, 191.25734534712993, 194.11423882909497, 199.0640773893267, 204.35421412120476, 209.8065743626783, 210.76136555703775, 215.2086824360277, 216.26397796663548, 221.4201005642282, 227.34985640288144, 232.22431671092693, 238.94813377141608, 244.29998967664127, 255.16014326208372, 260.3612426629364, 260.8637643441782, 266.08998982909293, 276.3842039465566, 281.1581599183537, 281.66516221081173, 287.67029630165126, 287.87130497414796, 294.02719556936006, 302.58979359470214, 308.8461885261626, 309.1225754508456, 314.02216184295315, 317.99946676189256, 323.42670091930404, 323.42670091930404, 328.6026742360946, 330.66301312918597, 336.6022363131309, 339.692744652768, 345.39636573486246, 346.774806914394, 352.629184500861, 353.2070844342891, 357.930788237962, 357.930788237962, 364.061552749112, 364.061552749112, 369.0432862953421, 370.65135567531587, 376.00321158054106, 376.2042202530378, 382.9882629498021, 384.02581628035705, 390.2319590436933, 390.3827155480658, 396.11146271422234, 396.3627235548432, 402.28878112017554, 402.5902941289206, 408.2436630428909, 408.9723194806915, 414.5503101424755, 414.8266970671585, 420.55544423331503, 422.8757160649109, 428.227571970136, 428.227571970136, 433.27791486661613, 434.2075799769135, 440.41372274024974, 442.3872163759319, 447.81445053334335, 454.4226106416731, 458.4176580075454, 459.0567707445814, 463.679970212006, 463.679970212006, 469.3333391259763, 475.26309496462954, 480.0873031045508];
% % aj_185_5m_d3
% moments = [48.081830074557296, 54.6085793993898, 54.6085793993898, 60.7789375, 61.887602277222726, 67.67808880873814, 88.42845358404482, 94.17308486595026, 94.93682197279317, 101.31236651687318, 102.46356250000001, 108.50228958570645, 109.1996147702152, 115.2098937414573, 117.39239431816316, 123.83435078457734, 124.36564616325067, 130.7411907073307, 132.06033629369236, 138.10382122610156, 138.70152852710908, 144.44615980901455, 145.06798021086738, 150.5137578422691, 166.78131786001953, 171.96144780208456, 187.61118267308538, 194.6704131111915, 203.1711391699649, 209.34744794704244, 223.43487834016784, 228.88065597156955, 237.87947144784923, 244.96499046488086, 249.45475000000002, 255.73063926525754, 256.66570375245954, 262.01186350036, 263.76227329801185, 269.95577779369313, 269.95577779369313, 276.377177587383, 276.377177587383, 282.51000206693135, 282.51000206693135, 288.85352612588474, 288.85352612588474, 295.8063125, 302.7794731433355, 308.922575959246, 310.4077510928829, 317.67985658847425, 319.2548264902313, 326.2944902576531, 326.2944902576531, 332.86518031091964, 333.59571145659544, 339.2075188938326, 339.2075188938326, 347.0510431115059, 347.0510431115059, 353.4335050378276, 354.5293017563414, 360.4399628440823, 360.4399628440823, 366.45715919756594, 367.58616187724675, 373.59644084848895, 374.0854374056733, 379.79686272641175, 381.02548328959386, 386.3716430374943, 394.81860646237647, 399.60026487043655, 400.26438409377823, 405.8281608033251, 406.95716348300596, 412.3697351532406, 413.16118750000004, 419.4277801153064, 420.88884240665806, 426.401031960394, 427.6869715855883, 433.6972505568305, 444.7846806325158, 450.2968701862517, 453.1020625, 458.6315664391897, 459.2213635117557, 464.53431729848916, 465.2854375, 471.8064227940805, 471.8064227940805, 477.05296465847977, 478.14876137699355, 483.32889131905864, 496.441885025936, 501.89458003957924, 501.89458003957924, 506.941886136976];

filepath = './aj_185_3m_d4/c/';
filename = 'atf.txt';
fid = fopen([filepath filename], 'rb');
file_lines = 0;
while 1
    tline = fgetl(fid);
    if ~ischar(tline)
        break;
    end
    file_lines = file_lines + 1;
end

query_in_files = file_lines / 7;
fclose(fid);

fid = fopen([filepath filename], 'rb');


boundaries = zeros(1, query_in_files * 2);

moment_index = 0;

FreLen_atf = 257;
query_num = size(moments, 2) / 2;
which_is_query = zeros(1, query_num);


query_index_1 = 1;
query_index_2 = 1;
query_index_3 = 1;
query_index_4 = 1;
query_index_5 = 1;
query_index_6 = 1;

atf_moments_plot_1_c = ones(FreLen_atf, query_num);
atf_moments_plot_2_c = ones(FreLen_atf, query_num);
atf_moments_plot_3_c = ones(FreLen_atf, query_num);
atf_moments_plot_4_c = ones(FreLen_atf, query_num);
atf_moments_plot_5_c = ones(FreLen_atf, query_num);
atf_moments_plot_6_c = ones(FreLen_atf, query_num);

atf_moments_plot_1_cc = ones(FreLen_atf, query_in_files);
atf_moments_plot_2_cc = ones(FreLen_atf, query_in_files);
atf_moments_plot_3_cc = ones(FreLen_atf, query_in_files);
atf_moments_plot_4_cc = ones(FreLen_atf, query_in_files);
atf_moments_plot_5_cc = ones(FreLen_atf, query_in_files);
atf_moments_plot_6_cc = ones(FreLen_atf, query_in_files);

index = 0;
boundary_index = 1;
while 1
    tline = fgetl(fid);
    if ~ischar(tline)
        break;
    end
    if (mod(index, 7) == 0)
        boundary = tline;
        boundary = str2num(boundary);
%          boundary
        
        boundaries(boundary_index:boundary_index +1) = boundary;
        boundary_index = boundary_index + 2;
    else
        atf_coeff = tline;
        atf_coeff = str2num(atf_coeff);
        atf_coeff = atf_coeff ./ abs(atf_coeff);
            
        if(mod(index, 7) == 1)
            atf_moments_plot_1_cc(:, query_index_1) = atf_coeff.';
            atf_moments_plot_1_cc(:, query_index_1) = 1;
            query_index_1 = query_index_1 + 1;
        elseif (mod(index, 7) == 2)
            atf_moments_plot_2_cc(:, query_index_2) = atf_coeff.';
            query_index_2 = query_index_2 + 1;
        elseif (mod(index, 7) == 3)
            atf_moments_plot_3_cc(:, query_index_3) = atf_coeff.';
            query_index_3 = query_index_3 + 1;
        elseif (mod(index, 7) == 4)
            atf_moments_plot_4_cc(:, query_index_4) = atf_coeff.';
            query_index_4 = query_index_4 + 1;
        elseif (mod(index, 7) == 5)
            atf_moments_plot_5_cc(:, query_index_5) = atf_coeff.';
            query_index_5 = query_index_5 + 1;
        elseif (mod(index, 7) == 6)
            atf_moments_plot_6_cc(:, query_index_6) = atf_coeff.';
            query_index_6 = query_index_6 + 1;
        end        
    end
    
    index = index + 1; 
end
fclose(fid);


%% boundaries and moments comparison
j = 1;
for i = 1:query_num
    while j <= query_in_files
        if moments(2*i-1) < boundaries(2*j - 1) && moments(2*i) > boundaries(2*j)
            which_is_query(i) = j;
            break;
        end
        j = j + 1;
    end
    
    if j > query_in_files
        if i == 1
            which_is_query(i) = 0;
        else
            which_is_query(i) = which_is_query(i-1);
        end 
    end
    j = i + 1;
end

%如果没有找到对应的query段，就置1
for i = 1:query_num
    if which_is_query(i)
        atf_moments_plot_1_c(:, i) = atf_moments_plot_1_cc(:, which_is_query(i));
        atf_moments_plot_2_c(:, i) = atf_moments_plot_2_cc(:, which_is_query(i));
        atf_moments_plot_3_c(:, i) = atf_moments_plot_3_cc(:, which_is_query(i));
        atf_moments_plot_4_c(:, i) = atf_moments_plot_4_cc(:, which_is_query(i));
        atf_moments_plot_5_c(:, i) = atf_moments_plot_5_cc(:, which_is_query(i));
        atf_moments_plot_6_c(:, i) = atf_moments_plot_6_cc(:, which_is_query(i));
    end
end

    